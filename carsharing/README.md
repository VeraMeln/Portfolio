# Система оценки риска ДТП

## Задача

Поступил заказ от каршеринговой компании: нужно создать систему, которая могла бы оценить риск ДТП по выбранному маршруту движения. Под риском понимается вероятность ДТП с любым повреждением транспортного средства. Как только водитель забронировал автомобиль, сел за руль и выбрал маршрут, система должна оценить уровень риска. Если уровень риска высок, водитель увидит предупреждение и рекомендации по маршруту.

Идея создания такой системы находится в стадии предварительного обсуждения и проработки. Чёткого алгоритма работы и подобных решений на рынке ещё не существует. Текущая задача — понять, возможно ли предсказывать ДТП, опираясь на исторические данные одного из регионов.

## Используемые библиотеки

sqlalchemy, sklearn, lightgbm, catboost, matplotlib, seaborn,  pandas, numpy

## Данные

Данные хранятся в трех таблицах базы данных.

**collisions**

Эта таблица описывает общую информацию о ДТП. Например, где оно произошло и когда.

**parties**

Каждая строка здесь описывает однуиз сторон, участвующих в ДТП. Если столкнулись две машины, в этой таблице должно быть две строки с совпадением case_id. Имеет неуникальный case_id, который сопоставляется с соответствующим ДТП в таблице collisions. Если нуженуникальный идентификатор, это case_id and party_number. 

**vehicles**

Каждаястрока содержит данные о пострадавших машинах. Имеет неуникальные case_id и неуникальные party_number, которые сопоставляются с таблицей collisions и таблицей parties. Если нужен уникальный идентификатор, это case_id and party_number.

К таблицам надо образаться с помощью запросов SQL.

## Результаты

Проведен **предварительный анализ данных**. На его основе отобраны признаки, которые будут переданы модели для обучения.

Проведена **предварительная обработка данных**. Удалены дубликаты, заполнены пропуски. Подготовлены выборки для обучения и тестирования моделей. Проведено One-Hot кодирование категориальных признаков, затем масштабирование всех признаков.

Подобраны гиперпараметры для четырех моделей: **LGBMClassifier, CatBoostClassifier, DecisionTreeClassifier, RandomForestClassifier**. 

Качество модели оценивалось по **метрике F1**.

**Лучшей** оказалась модель **DecisionTreeClassifier с гиперпараметрами**:
- class_weight='balanced', 
- criterion='entropy',
- max_depth=5, 
- max_features='log2', 
- random_state=12345

Показатель F1 на тестовой выборке составил 0,58.

Построена кривая точности-полноты. Проведен **анализ важности признаков**. 
Самыми важными характеристиками оказались 
- физическое состояние участника с учётом принятых лекарств
- усталость водителя
- состояние прибора управления
- погода.

По результатам разработки модели сформулированы **рекомендации по сбору данных**:
    
1.	Собрать данные о предполагаемом маршруте путешествия. Это позволит модели получить информацию о состоянии дорог до поездки.
2.	Связать работу модели с навигатором в авто. Это позволит использовать данные о текущем трафике.
3.	Собрать данные о наиболее аварийных участках той местности, на территории которой предоставляются услуги каршеринга. Тогда в сочетании с предполагаемым маршрутом можно будет точнее рассчитать степень риска. Со временем можно задуматься о создании рекомендательной системы, которая будет генерировать более безопасный маршрут.
4.	При оформлении аренды машины просить водителя указывать серию и номер водительских прав. На сайте ГИБДД можно найти решение суда о лишении прав водителя, таким образом мы снизим риски на дорогах. Также существуют сервисы и порталы, которые предоставляют информацию о прошлых авариях по правам.
